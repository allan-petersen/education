SELECT soridentifier, provideridentifier, eanlocationcode, entityname, aliasnames
FROM spo_provider_new
WHERE  enddate IS NULL
AND eanlocationcode IN (
   SELECT eanlocationcode
   FROM spo_provider_new
   WHERE enddate IS NULL
   AND provideridentifier IN (
      SELECT provideridentifier
      FROM spo_provider_new
      WHERE enddate IS NULL
      AND provideridentifier IS NOT NULL
      GROUP BY provideridentifier
      -- Number of group members
      HAVING COUNT(DISTINCT eanlocationcode) > 1
    )
)
-- REF AND provideridentifier = 407674  
-- REF SJ provideridentifier = 090263
-- ERROR 537802
-- AND provideridentifier = 537802
-- AND eanlocationcode IN (
-- REF 5790002412783, 5790002634574
-- REF SJ 5790002269813, 5790002762338, 5790002762901
-- ERROR 5790000178513
-- 5790000178513
-- )
-- ORDER BY provideridentifier, eanlocationcode
ORDER BY
    eanlocationcode,
    provideridentifier DESC;
